<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ระบบเช็คชื่อนักเรียน</title>
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert2/11.7.32/sweetalert2.all.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
<link rel="stylesheet" href="style.css">
</head>
<body>

<!-- SEARCH MODAL -->
<div id="searchModal" class="modal-overlay" onclick="if(event.target===this)closeSearch()">
  <div class="search-box">
    <div class="search-header">
      <i class="fas fa-search"></i>
      <input type="text" id="searchInput" placeholder="พิมพ์ชื่อหรือเลขที่..." oninput="doSearch(this.value)" autocomplete="off">
      <button onclick="closeSearch()"><i class="fas fa-times"></i></button>
    </div>
    <div id="searchResults"></div>
  </div>
</div>

<!-- TOP NAV -->
<nav class="topnav">
  <button class="menu-toggle" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
  <div class="logo-wrap">
    <div class="logo-icon"><i class="fas fa-graduation-cap"></i></div>
    <span class="logo-title">ระบบเช็คชื่อ</span>
  </div>
  <div class="nav-right">
    <button class="nav-icon-btn" onclick="openSearch()"><i class="fas fa-search"></i></button>
    <button class="nav-icon-btn" onclick="loadAllData(true)"><i class="fas fa-sync-alt" id="refreshIcon"></i></button>
  </div>
</nav>

<div id="sidebarOverlay" class="sidebar-overlay" onclick="closeSidebar()"></div>

<!-- SIDEBAR -->
<aside class="sidebar" id="sidebar">
  <nav class="sidebar-nav">
    <div class="sidebar-section-label">เมนูหลัก</div>
    <div class="nav-item active" data-page="dashboard" onclick="showPage('dashboard',this)">
      <i class="fas fa-home"></i><span>หน้าหลัก</span>
    </div>
    <div class="nav-item" data-page="checkin" onclick="showPage('checkin',this)">
      <i class="fas fa-clipboard-check"></i><span>เช็คชื่อนักเรียน</span>
    </div>
    <div class="nav-item" data-page="statistics" onclick="showPage('statistics',this)">
      <i class="fas fa-chart-line"></i><span>สถิติการเข้าเรียน</span>
    </div>
    <div class="nav-item" data-page="addstudent" onclick="showPage('addstudent',this)">
      <i class="fas fa-user-plus"></i><span>เพิ่มรายชื่อนักเรียน</span>
    </div>
    <div class="sidebar-section-label">ข้อมูล</div>
    <div class="nav-item" data-page="students-list" onclick="showPage('students-list',this)">
      <i class="fas fa-users"></i><span>รายชื่อนักเรียน</span>
    </div>
  </nav>
  <div class="sidebar-footer">
    <span class="online-dot"></span>ระบบออนไลน์ · Google Sheets
  </div>
</aside>

<!-- MAIN -->
<main class="main" id="main">

  <!-- DASHBOARD -->
  <div class="page active" id="page-dashboard">
    <div class="page-header">
      <h1><i class="fas fa-home"></i> หน้าหลัก</h1>
      <p>ภาพรวมระบบเช็คชื่อนักเรียน</p>
    </div>
    <div class="stat-grid">
      <div class="stat-card c-green"><i class="fas fa-check-circle"></i><div><span>มาเรียน</span><strong id="dash-present">—</strong></div></div>
      <div class="stat-card c-yellow"><i class="fas fa-clock"></i><div><span>มาสาย</span><strong id="dash-late">—</strong></div></div>
      <div class="stat-card c-blue"><i class="fas fa-file-alt"></i><div><span>ลา</span><strong id="dash-leave">—</strong></div></div>
      <div class="stat-card c-red"><i class="fas fa-times-circle"></i><div><span>ขาด</span><strong id="dash-absent">—</strong></div></div>
    </div>
    <div class="dash-row">
      <div class="card">
        <div class="card-title"><i class="fas fa-bolt"></i> เมนูด่วน</div>
        <div class="quick-menu">
          <div class="quick-item" onclick="showPage('checkin',document.querySelector('[data-page=checkin]'))">
            <div class="qi-icon blue"><i class="fas fa-clipboard-check"></i></div>
            <div class="qi-text"><strong>เช็คชื่อนักเรียน</strong><span>บันทึกการเข้าเรียน</span></div>
            <i class="fas fa-chevron-right qi-arrow"></i>
          </div>
          <div class="quick-item" onclick="showPage('statistics',document.querySelector('[data-page=statistics]'))">
            <div class="qi-icon green"><i class="fas fa-chart-line"></i></div>
            <div class="qi-text"><strong>ดูสถิติ</strong><span>รายงานสรุป</span></div>
            <i class="fas fa-chevron-right qi-arrow"></i>
          </div>
          <div class="quick-item" onclick="showPage('addstudent',document.querySelector('[data-page=addstudent]'))">
            <div class="qi-icon yellow"><i class="fas fa-user-plus"></i></div>
            <div class="qi-text"><strong>เพิ่มนักเรียน</strong><span>เพิ่มรายชื่อใหม่</span></div>
            <i class="fas fa-chevron-right qi-arrow"></i>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="card-title"><i class="fas fa-calendar-alt"></i> ข้อมูลวันนี้</div>
        <div class="clock-wrap">
          <div id="clock-day" class="clk-day"></div>
          <div id="clock-date" class="clk-date"></div>
          <div id="clock-time" class="clk-time"></div>
        </div>
        <div class="info-row">
          <div class="info-item"><span>นักเรียนทั้งหมด</span><strong id="dash-total">0</strong></div>
          <div class="info-item"><span>วันที่เช็คชื่อ</span><strong id="dash-days">—</strong></div>
          <div class="info-item"><span>อัตราเข้าเรียน</span><strong id="dash-rate">—</strong></div>
        </div>
      </div>
    </div>
  </div>

  <!-- CHECK-IN -->
  <div class="page" id="page-checkin">
    <div class="page-header">
      <h1><i class="fas fa-clipboard-check"></i> เช็คชื่อนักเรียน</h1>
      <p>บันทึกการเข้าเรียนประจำวัน</p>
    </div>
    <div class="card" style="margin-bottom:14px;">
      <div class="card-title"><i class="fas fa-filter"></i> เลือกวันที่และชั้นเรียน</div>
      <div class="form-row-2">
        <div class="form-group">
          <label class="flabel"><i class="fas fa-calendar"></i> วันที่</label>
          <input type="date" class="finput" id="checkin-date">
        </div>
        <div class="form-group">
          <label class="flabel"><i class="fas fa-door-open"></i> ชั้นเรียน</label>
          <select class="finput" id="checkin-class" onchange="loadCheckin()">
            <option value="">— เลือกชั้น —</option>
            <option>ม.1</option><option>ม.2</option><option>ม.3</option>
            <option>ม.4</option><option>ม.5</option><option>ม.6</option>
          </select>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-row">
        <div class="card-title"><i class="fas fa-list"></i> รายชื่อนักเรียน</div>
        <button class="btn-sm green" onclick="setAllPresent()"><i class="fas fa-check"></i> ทุกคนมา</button>
      </div>
      <div id="checkin-wrap">
        <div class="empty-state"><i class="fas fa-arrow-up"></i><p>กรุณาเลือกชั้นเรียนก่อน</p></div>
      </div>
    </div>
    <div id="save-section" style="display:none;margin-top:14px;">
      <button class="btn primary full" onclick="saveCheckin()"><i class="fas fa-save"></i> บันทึกการเช็คชื่อ</button>
    </div>
  </div>

  <!-- STATISTICS -->
  <div class="page" id="page-statistics">
    <div class="page-header">
      <h1><i class="fas fa-chart-line"></i> สถิติการเข้าเรียน</h1>
      <p>รายงานสรุปสถิติการเข้าเรียนของนักเรียน</p>
    </div>
    <div class="stat-grid" style="margin-bottom:16px;">
      <div class="stat-card c-green"><i class="fas fa-check-circle"></i><div><span>มาเรียน</span><strong id="st-present">0</strong></div></div>
      <div class="stat-card c-yellow"><i class="fas fa-clock"></i><div><span>มาสาย</span><strong id="st-late">0</strong></div></div>
      <div class="stat-card c-blue"><i class="fas fa-file-alt"></i><div><span>ลา</span><strong id="st-leave">0</strong></div></div>
      <div class="stat-card c-red"><i class="fas fa-times-circle"></i><div><span>ขาด</span><strong id="st-absent">0</strong></div></div>
    </div>
    <div class="card" style="margin-bottom:16px;">
      <div class="card-title"><i class="fas fa-chart-line"></i> กราฟสถิติรายชั้น</div>
      <div class="legend-row">
        <span class="leg"><span style="background:#10b981"></span>มา</span>
        <span class="leg"><span style="background:#f59e0b"></span>สาย</span>
        <span class="leg"><span style="background:#06b6d4"></span>ลา</span>
        <span class="leg"><span style="background:#ef4444"></span>ขาด</span>
      </div>
      <div class="chart-wrap"><canvas id="lineChart"></canvas></div>
    </div>
    <div class="card">
      <div class="card-row">
        <div class="card-title"><i class="fas fa-table"></i> สถิติรายนักเรียน</div>
        <select class="finput" id="stat-filter" onchange="renderStats()" style="width:auto;font-size:12px;">
          <option value="">ทุกชั้น</option>
          <option>ม.1</option><option>ม.2</option><option>ม.3</option>
          <option>ม.4</option><option>ม.5</option><option>ม.6</option>
        </select>
      </div>
      <div class="table-wrap" id="stats-wrap">
        <div class="empty-state"><i class="fas fa-chart-bar"></i><p>ยังไม่มีข้อมูล</p></div>
      </div>
    </div>
  </div>

  <!-- ADD STUDENT — FIXED -->
  <div class="page" id="page-addstudent">
    <div class="page-header">
      <h1><i class="fas fa-user-plus"></i> เพิ่มรายชื่อนักเรียน</h1>
      <p>เพิ่มข้อมูลนักเรียนใหม่เข้าสู่ระบบ</p>
    </div>
    <div class="card" style="max-width:520px;">
      <div class="card-title"><i class="fas fa-user-edit"></i> ข้อมูลนักเรียน</div>
      <div class="form-row-3">
        <!-- FIX: Custom number input with themed spinner -->
        <div class="form-group">
          <label class="flabel"><i class="fas fa-hashtag"></i> เลขที่</label>
          <div class="num-input-wrap">
            <input type="number" class="finput" id="add-num" placeholder="1" min="1" max="99">
            <div class="num-spin-btns">
              <button type="button" class="num-spin-btn" onclick="spinNum(1)" tabindex="-1">
                <i class="fas fa-chevron-up"></i>
              </button>
              <button type="button" class="num-spin-btn" onclick="spinNum(-1)" tabindex="-1">
                <i class="fas fa-chevron-down"></i>
              </button>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label class="flabel"><i class="fas fa-layer-group"></i> ชั้น</label>
          <select class="finput" id="add-class">
            <option value="">— ชั้น —</option>
            <option>ม.1</option><option>ม.2</option><option>ม.3</option>
            <option>ม.4</option><option>ม.5</option><option>ม.6</option>
          </select>
        </div>
        <div class="form-group">
          <label class="flabel"><i class="fas fa-chalkboard"></i> ห้อง</label>
          <input type="text" class="finput" id="add-room" placeholder="เช่น 1/1">
        </div>
      </div>
      <div class="form-group" style="margin-bottom:20px;">
        <label class="flabel"><i class="fas fa-user"></i> ชื่อ-สกุล</label>
        <input type="text" class="finput" id="add-name" placeholder="เช่น นาย ธนภัทร สุขสวัสดิ์">
      </div>
      <button class="btn primary full" onclick="addStudent()">
        <i class="fas fa-plus-circle"></i> เพิ่มนักเรียน
      </button>
    </div>
  </div>

  <!-- STUDENTS LIST -->
  <div class="page" id="page-students-list">
    <div class="page-header">
      <h1><i class="fas fa-users"></i> รายชื่อนักเรียน</h1>
      <p>จัดการรายชื่อและบันทึกสถานะวันนี้</p>
    </div>
    <div class="card">
      <div class="card-row">
        <div class="card-title"><i class="fas fa-list-ul"></i> นักเรียนทั้งหมด</div>
        <div style="display:flex;gap:8px;">
          <select class="finput" id="list-filter" onchange="renderStudentList()" style="width:auto;font-size:12px;">
            <option value="">ทุกชั้น</option>
            <option>ม.1</option><option>ม.2</option><option>ม.3</option>
            <option>ม.4</option><option>ม.5</option><option>ม.6</option>
          </select>
          <button class="btn-sm blue" onclick="showPage('addstudent',document.querySelector('[data-page=addstudent]'))">
            <i class="fas fa-plus"></i> เพิ่ม
          </button>
        </div>
      </div>
      <div id="student-list-wrap">
        <div class="empty-state"><div class="spinner"></div><p>กำลังโหลด...</p></div>
      </div>
    </div>
  </div>

</main>

<!-- ปุ่มลบข้อมูลทั้งหมด -->
<button class="settings-btn" onclick="clearAllData()" title="ลบข้อมูลทั้งหมด">
  <i class="fas fa-trash-alt"></i>
</button>

<div id="toast-wrap"></div>
<script src="script.js"></script>
</body>
</html>
